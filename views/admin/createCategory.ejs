
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Nest Dashboard</title>
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta property="og:title" content="" />
        <meta property="og:type" content="" />
        <meta property="og:url" content="" />
        <meta property="og:image" content="" />
        <!-- Favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg" />
        <!-- Template CSS -->
        <link href="assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
        <!-- CDN for sweet alert -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>

    <body>
        <div class="screen-overlay"></div>
        <aside class="navbar-aside" id="offcanvas_aside">
            <div class="aside-top">
                <a href="index.html" class="brand-wrap">
                    <img src="assets/imgs/theme/logo.svg" class="logo" alt="Nest Dashboard" />
                </a>
                <div>
                    <button class="btn btn-icon btn-aside-minimize"><i class="text-muted material-icons md-menu_open"></i></button>
                </div>
            </div>
            <nav>
                <ul class="menu-aside">
                    <li id="dashboard"  class="menu-item">
                        <a class="menu-link" href="/admin/dashboard">
                            <i class="icon material-icons md-home"></i>
                            <span class="text">Dashboard</span>
                        </a>
                    </li>
                    <li  id="users" class="menu-item">
                        <a class="menu-link" href="/admin/users">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">Users</span>
                        </a>
                    </li>
                    <li  id="orders" class="menu-item">
                        <a class="menu-link" href="/admin/orders">
                            <i class="icon material-icons md-shopping_cart"></i>
                            <span class="text">Orders</span>
                        </a>
                    </li>
                    <li  id="products" class="menu-item">
                        <a class="menu-link" href="/admin/products">
                            <i class="icon material-icons md-shopping_bag"></i>
                            <span class="text">Products</span>
                        </a>
                    </li>
                    <li id="categories" class="menu-item">
                        <a class="menu-link" href="/admin/categories">
                            <i class="icon material-icons md-category"></i>
                            <span class="text">Categories</span>
                        </a>
                    </li>
                    <li  id="salesReport" class="menu-item">
                        <a class="menu-link" href="/admin/salesReport">
                            <i class="icon material-icons md-business"></i>
                            <span class="text">Sales Reports</span>
                        </a>
                    </li>
                    <li  id="offers" class="menu-item">
                        <a class="menu-link" href="/admin/offers">
                            <i class="icon material-icons md-local_offer"></i>
                            <span class="text">Offers</span>
                        </a>
                    </li>
                    <li  id="coupons" class="menu-item">
                        <a class="menu-link" href="/admin/coupons">
                            <i class="icon material-icons md-card_giftcard"></i>
                            <span class="text">Coupons</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-wrap">
            <header class="main-header navbar">
                <div class="col-search">
                    <form class="searchform">
                        <div class="input-group">
                            <input list="search_terms" type="text" class="form-control" placeholder="Search term" />
                            <button class="btn btn-light bg" type="button"><i class="material-icons md-search"></i></button>
                        </div>

                        </form>
                </div>
                <div class="col-nav">
                    <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i class="material-icons md-apps"></i></button>
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link btn-icon" href="#">
                                <i class="material-icons md-notifications animation-shake"></i>
                                <span class="badge rounded-pill">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i> </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage" aria-expanded="false"><i class="material-icons md-public"></i></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                                <a class="dropdown-item text-brand" href="#"><img src="assets/imgs/theme/flag-us.png" alt="English" />English</a>
                                <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-fr.png" alt="Français" />Français</a>
                                <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-jp.png" alt="Français" />日本語</a>
                                <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-cn.png" alt="Français" />中国人</a>
                            </div>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount" aria-expanded="false"> <img class="img-xs rounded-circle" src="assets/imgs/people/avatar-2.png" alt="User" /></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit Profile</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account Settings</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help center</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger" href="#"><i class="material-icons md-exit_to_app"></i>Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </header>
        
            
            <form id="categoryForm">
                <div class="mb-4">
                    <label for="product_name" class="form-label">Name</label>
                    <input type="text" placeholder="Type here" style="width: 50%;" class="form-control" id="category-name" name="categoryName" required />
                         <span id="product_nameError" class="text-danger" style="display: none;">Category name is required and cannot contain special characters!</span>
                </div>
                <div class="mb-4">
                    <label class="form-label">Description</label>
                    <textarea placeholder="Type here"  style="width: 50%;" class="form-control" id="category-description" name="categoryDescription" required></textarea>
                    <span id="product_descriptionError" class="text-danger" style="display: none;">Description must contain more than 6 words!</span>
                </div>
                
                <div class="d-grid">
                    <button class="btn btn-primary  btn-custom-size"  type="submit" style="width: 200px;">Create category</button>
                </div>
                
                
            </form>
             

            
<!-- Update Category Modal -->
<div id="updateCategoryModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeUpdateModal">&times;</span>
        <h2>Update Category</h2>
        <input type="hidden" id="modalCategoryId">
        <label for="modalCategoryName">Category Name:</label>
        <input type="text" id="modalCategoryName" name="modalCategoryName" placeholder="Category Name">
        <label for="modalCategoryDescription">Category Description:</label>
        <textarea id="modalCategoryDescription" name="modalCategoryDescription" placeholder="Category Description"></textarea>
        <button type="button" id="saveUpdateCategoryButton">Save</button>
    </div>
</div>

<!-- Add some CSS for modal -->
<style>
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); }
    .modal-content { background-color: #fff; margin: 15% auto; padding: 20px; width: 400px; border-radius: 8px; }
    .close { float: right; cursor: pointer; }
</style>

            </main>


        <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="assets/js/vendors/select2.min.js"></script>
        <script src="assets/js/vendors/perfect-scrollbar.js"></script>
        <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
        <!-- Main Script -->
        <script src="assets/js/main.js?v=1.1" type="text/javascript"></script>
       
       
        

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Ensure the form elements are present
                const categoryForm = document.getElementById('categoryForm');
                const categoryNameInput = document.getElementById('category-name');
                const categoryDescriptionInput = document.getElementById('category-description');
        
                if (!categoryForm || !categoryNameInput || !categoryDescriptionInput) {
                    console.error("Form elements not found.");
                    return;
                }
        
                // Real-time validation for category name
                categoryNameInput.addEventListener('input', function () {
                    const categoryName = this.value;
                    if (!categoryName || /[!@#$%^&*(),.?":{}|<>]/.test(categoryName)) {
                        showValidationMessage('product_nameError', 'Category name is required and cannot contain special characters!');
                    } else {
                        clearValidationMessage('product_nameError');
                    }
                });
        
                // Real-time validation for category description
                categoryDescriptionInput.addEventListener('input', function () {
                    const description = this.value;
                    if (!description || description.split(' ').length < 6) {
                        showValidationMessage('product_descriptionError', 'Description must contain more than 6 words!');
                    } else {
                        clearValidationMessage('product_descriptionError');
                    }
                });
        
                // Handle form submission
                categoryForm.addEventListener('submit', function (event) {
                    event.preventDefault(); // Prevent the default form submission
        
                    const categoryName = categoryNameInput.value;
                    const categoryDescription = categoryDescriptionInput.value;
        
                    // Validate inputs before submitting the form
                    let isValid = true;
                    if (!categoryName || /[!@#$%^&*(),.?":{}|<>]/.test(categoryName)) {
                        showValidationMessage('product_nameError', 'Category name is required and cannot contain special characters!');
                        isValid = false;
                    } else {
                        clearValidationMessage('product_nameError');
                    }
        
                    if (!categoryDescription || categoryDescription.split(' ').length < 6) {
                        showValidationMessage('product_descriptionError', 'Description must contain more than 6 words!');
                        isValid = false;
                    } else {
                        clearValidationMessage('product_descriptionError');
                    }
        
                    // If validation fails, stop the form submission
                    if (!isValid) {
                        return;
                    }
        
                    // Send a POST request to create a new category if validation succeeds
                    fetch('/admin/category', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            categoryName: categoryName,
                            categoryDescription: categoryDescription
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Handle success and show SweetAlert
                        if (data.success) {
                            Swal.fire('Success', 'Category created successfully!', 'success');
                            loadCategories(currentPage); // Reload categories to show the new category
                            categoryForm.reset(); // Clear the form fields
                            clearValidationMessage('product_nameError'); // Clear any validation messages
                            clearValidationMessage('product_descriptionError');
                        } else if (data.error) {
                            Swal.fire('Error', data.error, 'error');
                        }
                    })
                    .catch(error => console.error('Error adding category:', error));
                });
        
                // Define show and clear validation functions if not already defined
                function showValidationMessage(errorId, message) {
                    const errorElement = document.getElementById(errorId);
                    if (errorElement) {
                        errorElement.textContent = message;
                        errorElement.style.display = 'inline';
                    }
                }
        
                function clearValidationMessage(errorId) {
                    const errorElement = document.getElementById(errorId);
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                }
            });
        </script>
        

     </body>

     </html>