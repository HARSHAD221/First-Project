<!-- <div class="demo-item">
                                                    <a href="index-1.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/1.jpg);"></span>
                                                        <span class="demo-title">01 - furniture store</span>
                                                    </a> -->
                                                <!-- </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-2.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/2.jpg);"></span>
                                                        <span class="demo-title">02 - furniture store</span>
                                                    </a>
                                                </div> -->
                                                <!-- End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-3.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/3.jpg);"></span>
                                                        <span class="demo-title">03 - electronic store</span>
                                                    </a> -->
                                                <!-- </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-4.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/4.jpg);"></span>
                                                        <span class="demo-title">04 - electronic store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-5.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/5.jpg);"></span>
                                                        <span class="demo-title">05 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->
<!-- 
                                                <div class="demo-item">
                                                    <a href="index-6.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/6.jpg);"></span>
                                                        <span class="demo-title">06 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-7.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/7.jpg);"></span>
                                                        <span class="demo-title">07 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->
<!-- 
                                                <div class="demo-item">
                                                    <a href="index-8.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/8.jpg);"></span>
                                                        <span class="demo-title">08 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-9.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/9.jpg);"></span>
                                                        <span class="demo-title">09 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item">
                                                    <a href="index-10.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/10.jpg);"></span>
                                                        <span class="demo-title">10 - shoes store</span>
                                                    </a>
                                                </div>End .demo-item -->
<!-- 
                                                <div class="demo-item hidden">
                                                    <a href="index-11.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/11.jpg);"></span>
                                                        <span class="demo-title">11 - furniture simple store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-12.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/12.jpg);"></span>
                                                        <span class="demo-title">12 - fashion simple store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-13.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/13.jpg);"></span>
                                                        <span class="demo-title">13 - market</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-14.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/14.jpg);"></span>
                                                        <span class="demo-title">14 - market fullwidth</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-15.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/15.jpg);"></span>
                                                        <span class="demo-title">15 - lookbook 1</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-16.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/16.jpg);"></span>
                                                        <span class="demo-title">16 - lookbook 2</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-17.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/17.jpg);"></span>
                                                        <span class="demo-title">17 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-18.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/18.jpg);"></span>
                                                        <span class="demo-title">18 - fashion store (with sidebar)</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-19.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/19.jpg);"></span>
                                                        <span class="demo-title">19 - games store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-20.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/20.jpg);"></span>
                                                        <span class="demo-title">20 - book store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-21.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/21.jpg);"></span>
                                                        <span class="demo-title">21 - sport store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-22.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/22.jpg);"></span>
                                                        <span class="demo-title">22 - tools store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-23.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/23.jpg);"></span>
                                                        <span class="demo-title">23 - fashion left navigation store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-24.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/24.jpg);"></span>
                                                        <span class="demo-title">24 - extreme sport store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-25.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/25.jpg);"></span>
                                                        <span class="demo-title">25 - jewelry store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-26.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/26.jpg);"></span>
                                                        <span class="demo-title">26 - market store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-27.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/27.jpg);"></span>
                                                        <span class="demo-title">27 - fashion store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-28.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/28.jpg);"></span>
                                                        <span class="demo-title">28 - food market store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-29.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/29.jpg);"></span>
                                                        <span class="demo-title">29 - t-shirts store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-30.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/30.jpg);"></span>
                                                        <span class="demo-title">30 - headphones store</span>
                                                    </a>
                                                </div>End .demo-item -->

                                                <!-- <div class="demo-item hidden">
                                                    <a href="index-31.html">
                                                        <span class="demo-bg" style="background-image: url(assets/images/menu/demos/31.jpg);"></span>
                                                        <span class="demo-title">31 - yoga store</span>
                                                    </a>
                                                </div>End .demo-item -->
                                            <!-- </div>End .demo-list -->

                                            <!-- <div class="megamenu-action text-center">
                                                <a href="#" class="btn btn-outline-primary-2 view-all-demos"><span>View All Demos</span><i class="icon-long-arrow-right"></i></a>
                                            </div>End .text-center -->
                                        <!-- </div>End .menu-col -->
                                    <!-- </div>End .megamenu -->

                                    







                                    <!-- <li>
                                    <a href="category.html" class="sf-with-ul">Shop</a>

                                    <div class="megamenu megamenu-md">
                                        <div class="row no-gutters">
                                            <div class="col-md-8">
                                                <div class="menu-col">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="menu-title">Shop with sidebar</div> End .menu-title -->
                                                            <!-- <ul>
                                                                <li><a href="category-list.html">Shop List</a></li>
                                                                <li><a href="category-2cols.html">Shop Grid 2 Columns</a></li>
                                                                <li><a href="category.html">Shop Grid 3 Columns</a></li>
                                                                <li><a href="category-4cols.html">Shop Grid 4 Columns</a></li>
                                                                <li><a href="category-market.html"><span>Shop Market<span class="tip tip-new">New</span></span></a></li>
                                                            </ul> --> 
                                                            <!-- <div class="menu-title">Shop no sidebar</div> End .menu-title -->
                                                            <!-- <ul>
                                                                <li><a href="category-boxed.html"><span>Shop Boxed No Sidebar<span class="tip tip-hot">Hot</span></span></a></li>
                                                                <li><a href="category-fullwidth.html">Shop Fullwidth No Sidebar</a></li>
                                                            </ul>
                                                        </div>End .col-md-6 --> 

                                                        <!-- <div class="col-md-6">
                                                            <div class="menu-title">Product Category</div> End .menu-title -->
                                                            <!-- <ul>
                                                                <li><a href="product-category-boxed.html">Product Category Boxed</a></li>
                                                                <li><a href="product-category-fullwidth.html"><span>Product Category Fullwidth<span class="tip tip-new">New</span></span></a></li>
                                                            </ul> -->
                                                            <!-- <div class="menu-title">Shop Pages</div>End .menu-title -->
                                                            <!-- <ul>
                                                                <li><a href="cart.html">Cart</a></li>
                                                                <li><a href="checkout.html">Checkout</a></li>
                                                                <li><a href="wishlist.html">Wishlist</a></li>
                                                                <li><a href="dashboard.html">My Account</a></li>
                                                                <li><a href="#">Lookbook</a></li>
                                                            </ul> --> 
                                                        <!-- </div> End .col-md-6 -->
                                                    <!-- </div> End .row -->
                                                <!-- </div>End .menu-col -->
                                            <!-- </div>End .col-md-8 --> 

                                            <!-- <div class="col-md-4">
                                                <div class="banner banner-overlay">
                                                    <a href="category.html" class="banner banner-menu">
                                                        <img src="assets/images/menu/banner-1.jpg" alt="Banner">

                                                        <div class="banner-content banner-content-top">
                                                            <div class="banner-title text-white">Last <br>Chance<br><span><strong>Sale</strong></span></div>End .banner-title -->
                                                        <!-- </div>End .banner-content
                                                    </a>
                                                </div> End .banner banner-overlay -->
                                            <!-- </div>End .col-md-4
                                        </div> End .row -->
                                    <!-- </div> End .megamenu megamenu-md -->
                                <!-- </li> -->







                                 <!-- <div class="megamenu megamenu-sm">
                                        <div class="row no-gutters">
                                            <div class="col-md-6">
                                                <div class="menu-col">
                                                    <div class="menu-title">Product Details</div> End .menu-title -->
                                                    <!-- <ul>
                                                        <li><a href="product.html">Default</a></li>
                                                        <li><a href="product-centered.html">Centered</a></li>
                                                        <li><a href="product-extended.html"><span>Extended Info<span class="tip tip-new">New</span></span></a></li>
                                                        <li><a href="product-gallery.html">Gallery</a></li>
                                                        <li><a href="product-sticky.html">Sticky Info</a></li>
                                                        <li><a href="product-sidebar.html">Boxed With Sidebar</a></li>
                                                        <li><a href="product-fullwidth.html">Full Width</a></li>
                                                        <li><a href="product-masonry.html">Masonry Sticky Info</a></li>
                                                    </ul> -->
                                                <!-- </div> End .menu-col -->
                                            <!-- </div>End .col-md-6 --> 

                                            <!-- <div class="col-md-6">
                                                <div class="banner banner-overlay">
                                                    <a href="category.html">
                                                        <img src="assets/images/menu/banner-2.jpg" alt="Banner">

                                                        <div class="banner-content banner-content-bottom">
                                                            <div class="banner-title text-white">New Trends<br><span><strong>spring 2019</strong></span></div><!-- End .banner-title -->
                                                        <!-- </div>End .banner-content --> 
                                                    <!-- </a>
                                                </div>< End .banner -->
                                            <!-- </div> End .col-md-6 -->
                                        <!-- </div>End .row -->
                                    <!-- </div>End .megamenu megamenu-sm -->
                                <!-- </li> --> 













                                data-toggle="modal"








                                // form for billing in the order section

                                <form action="#">
		                	<div class="row">
		                		<div class="col-lg-9">
		                			<h2 class="checkout-title">Billing Details</h2><!-- End .checkout-title -->
		                				<div class="row">
		                					<div class="col-sm-6">
		                						<label>First Name *</label>
		                						<input type="text" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->

		                					<div class="col-sm-6">
		                						<label>Last Name *</label>
		                						<input type="text" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->
		                				</div><!-- End .row -->

	            						<label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>

	            						<div class="row">
		                					<div class="col-sm-6">
		                						<label>Town / City *</label>
		                						<input type="text" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->

		                					<div class="col-sm-6">
		                						<label>State / County *</label>
		                						<input type="text" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->
		                				</div><!-- End .row -->

		                				<div class="row">
		                					<div class="col-sm-6">
		                						<label>Postcode / ZIP *</label>
		                						<input type="text" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->

		                					<div class="col-sm-6">
		                						<label>Phone *</label>
		                						<input type="tel" class="form-control" required>
		                					</div><!-- End .col-sm-6 -->
		                				</div><!-- End .row -->

	                					<label>Email address *</label>
	        							<input type="email" class="form-control" required>

	        							<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div><!-- End .custom-checkbox -->

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div><!-- End .custom-checkbox -->

	                					<label>Order notes (optional)</label>
	        							<textarea class="form-control" cols="30" rows="4" placeholder="Notes about your order, e.g. special notes for delivery"></textarea>
		                		</div><!-- End .col-lg-9 -->






// Payment section in the checkout

                                	<div class="accordion-summary" id="accordion-payment">
										    <div class="card">
										        <div class="card-header" id="heading-1">
										            <h2 class="card-title">
										                <a role="button" data-toggle="collapse" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
										                    Direct bank transfer
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-1" class="collapse show" aria-labelledby="heading-1" data-parent="#accordion-payment">
										            <div class="card-body">
										                Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-2">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
										                    Check payments
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-2" class="collapse" aria-labelledby="heading-2" data-parent="#accordion-payment">
										            <div class="card-body">
										                Ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. 
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-3">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
										                    Cash on delivery
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordion-payment">
										            <div class="card-body">Quisque volutpat mattis eros. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. 
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-4">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
										                    PayPal <small class="float-right paypal-link">What is PayPal?</small>
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-4" class="collapse" aria-labelledby="heading-4" data-parent="#accordion-payment">
										            <div class="card-body">
										                Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede. Donec nec justo eget felis facilisis fermentum.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-5">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
										                    Credit Card (Stripe)
										                    <img src="assets/images/payments-summary.png" alt="payments cards">
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-5" class="collapse" aria-labelledby="heading-5" data-parent="#accordion-payment">
										            <div class="card-body"> Donec nec justo eget felis facilisis fermentum.Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Lorem ipsum dolor sit ame.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->
										</div><!-- End .accordion -->




// section for showing order details in admin side
                                        <tr>
                                                <td colspan="4">
                                                    <article class="float-end">
                                                        <dl class="dlist">
                                                            <dt>Subtotal:</dt>
                                                            <dd>$<%= order.subtotal.toFixed(2) %></dd> <!-- Dynamic Subtotal -->
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt>Shipping cost:</dt>
                                                            <dd>$<%= order.shippingCost.toFixed(2) %></dd> <!-- Dynamic Shipping Cost -->
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt>Grand total:</dt>
                                                            <dd><b class="h5">$<%= order.grandTotal.toFixed(2) %></b></dd> <!-- Dynamic Grand Total -->
                                                        </dl>
                                                        <dl class="dlist">
                                                            <dt class="text-muted">Status:</dt>
                                                            <dd>
                                                                <span class="badge rounded-pill alert-success text-success">Payment done</span>
                                                            </dd>
                                                        </dl>
                                                    </article>
                                                </td>
          
          
          
                                            </tr>









                                               <div class="product-list">
                                    <% if (products.length === 0) { %>
                                      <p>No products available.</p>
                                    <% } else { %>
                                      <div class="row justify-content-center">
                                        <% products.forEach(function(product) { %>
                                          <div class="col-6 col-md-4 col-lg-3">
                                            <div class="product product-11 mt-v3 text-center">
                                              <!-- <figure class="product-media">
                                                <a href="/product?id=<%= product._id %>">
                                                   
                                                    <img src="<%= product.imagePaths[0] %>" alt="<%= product.productName %> Image" class="product-image primary-image" >
                                                    <img src="<%= product.imagePaths[1] %>" alt="<%= product.productName %> Image" class="product-image secondary-image">
                                                  </a>
                                                  
                                  
                                              
                                                <div class="product-action-vertical">
                                                  <a href="#" class="btn-product-icon btn-wishlist"><span>Add to Wishlist</span></a>
                                                </div>
                                              </figure> -->
                                              <figure class="product-media">
                                                <a href="/product?id=<%= product._id %>">
                                                    <img src="<%= product.imagePaths[0] %>" alt="Product image" class="">
                                                    <img src="<%= product.imagePaths[1] %>" alt="Product image" class="product-image-hover">
                                                </a>
            
                                                <div class="product-action-vertical">
                                                    <a href="#" class="btn-product-icon btn-wishlist"><span>add to wishlist</span></a>
                                                </div>
            
                                            </figure>
                                  
                                              <div class="product-body">
                                                <!-- Product Name -->
                                                <h3 class="product-title"><a href="/product/<%= product._id %>"><%= product.productName %></a></h3>
                                  
                                                <!-- Product Price -->
                                                <div class="product-price">
                                                  $<%= product.price.toFixed(2) %>
                                                </div>
                                  
                                                <!-- Optional: Color dots (if applicable) -->
                                                <div class="product-nav product-nav-dots">
                                                  <a href="#" class="active" style="background: #333333;"><span class="sr-only">Color name</span></a>
                                                  <a href="#" style="background: #e8e8e8;"><span class="sr-only">Color name</span></a>
                                                </div>
                                              </div>
                                  
                                              <!-- Add to Cart Button -->
                                              <div class="product-action">
                                                <a href="/cart/add/<%= product._id %>" class="btn-product btn-cart"><span>Add to Cart</span></a>
                                              </div>
                                            </div>
                                          </div>
                                        <% }); %>
                                      </div>
                                    <% } %>
                                  </div>











                                  place order

                                  
const placeOrder = async (req, res, next) => {
    try {
        console.log('reached for place order')
        const { address, paymentMethod } = req.body;
        const validPaymentMethod = paymentMethod === 'cash_on_delivery' ? 'COD' : paymentMethod;
        const userId = req.session.user ? req.session.user.id : null;

        if (!address || !paymentMethod) {
            return res.status(400).json({
                success: false,
                message: "Address and payment method are required"
            });
        }

        if (!userId) {
            return res.status(400).json({
                success: false,
                message: "User not authenticated"
            });
        }

        const cart = await Cart.findOne({ user: userId }).populate('products.product');

        if (!cart || cart.products.length === 0) {
            return res.status(400).json({
                success: false,
                message: 'Cart is empty'
            });
        }

              let totalPrice = 0;
              const productsWithPrices = [];


                for (let cartItem of cart.products) {
                    if (!cartItem.product.price) {
                        throw new Error(`Price not found for product ${cartItem.product.name}`);
                    }
                    const productStock = cartItem.product.stock;
                    if (productStock < cartItem.quantity) {
                        return res.status(400).json({
                            success: false,
                            message: `Insufficient stock for product: ${cartItem.product.productName}. Only ${productStock} left.`
                        });
                    }

                    totalPrice += cartItem.quantity * cartItem.product.price;

                    productsWithPrices.push({
                        product: cartItem.product._id,
                        quantity: cartItem.quantity,
                        price: cartItem.product.price
                    });
                }

                const newOrder = new Order({
                    user: userId,
                    products: productsWithPrices,  
                    totalPrice,
                    deliveryAddress: address,
                    paymentMethod: validPaymentMethod,
                    status: 'Pending'
                });

        const savedOrder = await newOrder.save();


        for (let cartItem of cart.products) {
            const product = await Product.findById(cartItem.product._id);
            product.stock -= cartItem.quantity;  
            await product.save();  
        }

        await Cart.deleteOne({ user: userId });

        let assignedCoupon = null;

        console.log('Assigned coupon:', assignedCoupon);

        if (totalPrice >= 3000 && totalPrice < 10000) {
            assignedCoupon = await Coupon.findOne({ discountAmount: 500, status: 'active' });
        } else if (totalPrice >= 10000) {
            assignedCoupon = await Coupon.findOne({ discountAmount: 1000, status: 'active' });
        }


        if (assignedCoupon) {

            const user = await User.findById(userId);

            if (user) {
                // Check if the coupon is already in the user's coupon array
                const alreadyHasCoupon = user.coupons.some(c => c.couponId && c.couponId.toString() === assignedCoupon._id.toString());

                if (!alreadyHasCoupon) {
                    // Add coupon to user's coupons array
                    user.coupons.push({
                        couponId: assignedCoupon._id, 
                        status: 'unused' 
                    });
                    await user.save(); 
                    console.log('Coupon added to user successfully.');
                } else {
                    console.log('User already has this coupon.');
                }
            }

            // 2. Update the Coupon model with the user's reference
            const userAlreadyAssigned = assignedCoupon.user.some(u => u.userId && u.userId.toString() === userId.toString());

            if (!userAlreadyAssigned) {
                // Add the user to the coupon's `user` array
                assignedCoupon.user.push({
                    userId: user._id, 
                    status: 'unused' 
                });
                await assignedCoupon.save(); 
                console.log('User added to coupon successfully.');
            } else {
                console.log('Coupon already assigned to this user.');
            }
        }

        console.log('Coupon assignment process completed.');



        res.status(200).json({
            success: true,
            orderId: savedOrder._id,
            coupon : assignedCoupon.code,
            message: "Your order has been placed"
        });

    } catch (error) {
        console.error("Error placing order", error.message);
        return res.status(500).json({
            success: false,
            message: error.message || 'An error occurred while placing your order. Please try again.'
        });
    }
};




// Event listener for dynamically added toggle buttons
document.addEventListener('click', function (event) {
    if (event.target.classList.contains('toggle-block-btn')) {
        const categoryId = event.target.getAttribute('data-id');
        console.log('Clicked category ID:', categoryId); 
        toggleCategoryBlockStatus(categoryId); // Call the function when button is clicked
    }
});




    // Function to show validation message
    function showValidationMessage(fieldId, message) {
        const field = document.getElementById(fieldId);
        field.classList.add('is-invalid'); // Add Bootstrap's invalid class

        const errorMessage = document.getElementById(`${fieldId}Error`);
        errorMessage.textContent = message; // Set the error message text
        errorMessage.style.display = 'block'; // Show the error message
    }

    // Function to clear validation message
    function clearValidationMessage(fieldId) {
        const field = document.getElementById(fieldId);
        field.classList.remove('is-invalid'); // Remove Bootstrap's invalid class

        const errorMessage = document.getElementById(`${fieldId}Error`);
        errorMessage.style.display = 'none'; // Hide the error message
    }

    // Event listener for the Previous button
    document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;  // Decrease the current page number
            loadCategories(currentPage);  // Load the previous page
        }
    });

    // Event listener for the Next button
    document.getElementById("nextBtn").addEventListener("click", () => {
        // Increase the current page number and load the next page
        currentPage++;
        loadCategories(currentPage);
    });

    // Real-time validation for category name
//     document.getElementById('product_name').addEventListener('input', function () {
//         const categoryName = this.value;
//         if (!categoryName || /[!@#$%^&*(),.?":{}|<>]/.test(categoryName)) {
//             showValidationMessage('product_name', 'Category name must not be empty or contain symbols.');
//         } else {
//             clearValidationMessage('product_name');
//         }
//     });

//     // Real-time validation for category description
//     document.getElementById('product_description').addEventListener('input', function () {
//         const description = this.value;
//         if (!description || description.split(' ').length < 6) {
//             showValidationMessage('product_description', 'Description must be more than 6 words.');
//         } else {
//             clearValidationMessage('product_description');
//         }
//     });

//     // Handle form submission
//     document.getElementById('categoryForm').addEventListener('submit', function (event) {
//         event.preventDefault(); // Prevent the default form submission

//         const categoryName = document.getElementById('product_name').value;
//         const categoryDescription = document.getElementById('product_description').value;

//         // Validate inputs before submitting the form
//         let isValid = true;
//         if (!categoryName || /[!@#$%^&*(),.?":{}|<>]/.test(categoryName)) {
//             showValidationMessage('product_name', 'Category name must not be empty or contain symbols.');
//             isValid = false;
//         } else {
//             clearValidationMessage('product_name');
//         }

//         if (!categoryDescription || categoryDescription.split(' ').length < 6) {
//             showValidationMessage('product_description', 'Description must be more than 6 words.');
//             isValid = false;
//         } else {
//             clearValidationMessage('product_description');
//         }

//         // If validation fails, stop the form submission
//         if (!isValid) {
//             return;
//         }

//         // Send a POST request to create a new category if validation succeeds
//         fetch('/admin/category', {
//             method: 'POST',
//             headers: {
//                 'Content-Type': 'application/json'
//             },
//             body: JSON.stringify({
//                 categoryName: categoryName,
//                 categoryDescription: categoryDescription
//             })
//         })
//         .then(response => {
//             if (!response.ok) {
//                 throw new Error('Network response was not ok');
//             }
//             return response.json();
//         })
//         .then(data => {
//             // Handle success and show SweetAlert
//             if (data.success) {
//                 Swal.fire('Success', 'Category created successfully!', 'success');
//                 loadCategories(currentPage); // Reload categories to show the new category
//                 document.getElementById('categoryForm').reset(); // Clear the form fields
//             } else if (data.error) {
//                 Swal.fire('Error', data.error, 'error');
//             }
//         })
//         .catch(error => console.error('Error adding category:', error));
//     });

//     // Load categories on page load
//     loadCategories(currentPage); // Ensure this is called only once
// });

        </script>


                <script>
        
            document.addEventListener('DOMContentLoaded', function () {
    console.log("Script is loaded!");

    const updateCategoryButton = document.getElementById('updateCategoryButton');
    if (updateCategoryButton) {
        console.log("Update category button found");

        updateCategoryButton.onclick = function() {
            console.log("Update category button clicked");
            const id = document.getElementById('updateCategoryId').value;
            const updatedName = document.getElementById('updateCategoryName').value.trim();
            const updatedDescription = document.getElementById('updateCategoryDescription').value.trim();

            console.log(`ID: ${id}, Name: ${updatedName}, Description: ${updatedDescription}`);
        };
    } else {
        console.error("Update category button not found");
    }
});


        </script>